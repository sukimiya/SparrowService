<!DOCTYPE html>
<!--
  ~ Project:sparrow nest
  ~ LastModified:18-4-17 下午6:26 by sukimiya
  ~
  ~ Copyright (C) 2018.  e2x.io
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->
<%
include("../header.btl",{title:"Sparrow Nest"}){}
%>
<%
include("../topnav.btl"){}
%>
<div class="bg-light">
    <div class="container d-flex justify-content-between page-header">
        <h1 class="p-2 align-self-center current-title">
        </h1>
        <div class="option-btn-group">
            <button type="button" class="btn btn-primary p-2 justify-content-end shadow mb-5 rounded-circle option-btn" data-toggle="modal" data-target="#clientaddModel">
                <span class="iconfont float-btn" aria-hidden="true">&#xe6ca;</span>
            </button>
        </div>
    </div>
</div>
        <div class="container s-page-content">
            <div class="justify-content-md-center">
                <div class="list-group col-lg">
                    <div class="list-group-item search-box fully">
                        <form action="${ctxPath}/admin/clientsSearch">
                                <div class="input-group">
                                    <%
                                        var thekey = "";
                                        if(isEmpty("searchkey")) thekey = searchkey;
                                    %>
                                    <input type="text" class="form-control search-box" name="key" placeholder="Search for..." value="${searchkey}">
                                    <!--<span class="input-group-btn">-->

                                    <!--</span>-->
                                </div>
                                <button class="btn btn-default iconfont navbar-toggler" type="submit">&#xe65c;</button>
                        </form>
                    </div>
                    <% for(entry in listmap){
                        var isActChecked="";
                        if(entry.enabled)
                        isActChecked="checked";
                    %>
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between">
                            <div class="d-flex flex-column justify-content-center col-md-6">

                                <div class="text-left" style="font-size: x-small">ID:${entry.id}</div>
                                <!--<div class="text-right"><div style="font-size: x-small">${entry.lastOp}</div></div>-->
                                <div class="text-left"><h5>${entry.clientId}</h5></div>
                                <!--<div class="col-md-4 text-right"><svg class="icon" width="32px" height="32.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M266.7 960c-10.3 0-20.5-4.4-27.6-12.9-12.8-15.2-10.8-37.9 4.4-50.7L701.7 512 243.5 127.6c-15.2-12.8-17.2-35.5-4.4-50.7 12.8-15.2 35.5-17.2 50.7-4.4l490.7 411.7c6.6 5.5 11 13.3 12.4 21.7l0.1 0.6c2.1 12.5-2.6 25.2-12.4 33.4L289.9 951.6c-6.8 5.6-15 8.4-23.2 8.4z" fill="#1296db" /></svg></div>-->
                                <!--<div class="col-md-8 text-left" style="font-size: x-small"></div>-->
                                <!--<div class="col-md-3 text-right" style="font-size: x-small;margin-top: 0px"><a class="" href="${ctxPath}/admin/clientsOp/+${entry.clientId}">Setting</a> </div>-->
                            </div>
                            <div class="d-flex flex-row justify-centent-between col-md-3">
                                <div class="text-left align-self-center" style="font-size: x-small">${entry.domain}</div>
                            </div>
                            <div class="d-flex flex-column justify-content-between col-md-2">
                                <label class="form-check-label" for="clientEnabled">active</label>
                                <input type="checkbox" class="form-check-input js-switch" id="clientActive_${entry.clientId}" name="clientActive" ${isActChecked}>
                                <label class="form-check-label">&nbsp;</label>
                            </div>
                            <div class="d-flex flex-row-reverse col-md-1">
                                <div class="text-right align-self-center">
                                    <div class="dropdown">
                                        <button class="btn btn-default navbar-toggler iconfont" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            &#xe6a5;
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                            <a class="dropdown-item" href="#">Authorise</a>
                                            <a class="dropdown-item" href="#">Edit</a>
                                            <a class="dropdown-item" href="#">Delete</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <%}%>
                </div>
            </div>
        </div>
<!-- Modal -->
<div class="modal fade" id="clientaddModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div id="ModelDialog" class="modal-dialog bg-light d-flex flex-column" role="document">
        <div class="modal-content">
            <div class="modal-header d-flex justify-content-between">
                <button type="button" class="close align-self-left" data-dismiss="modal" aria-label="Close">
                    <span class="iconfont" aria-hidden="true">&#xe679;</span>
                </button>
                <h5 class="modal-title-blue align-self-center">Add a Client</h5>
                <a class="modal-title-blue align-self-right" href="#">
                    <span class="iconfont" aria-hidden="true" style="color:transparent;">&#xe679;</span>
                </a>
            </div>
            <form id="addclientform" action="${ctxPath}/admin/client" method="post">
            <div class="modal-body">

                    <div class="form-group">
                        <label for="clientid">https://localhost/client/</label>
                        <input type="text" class="form-control" id="clientid" name="clientid" aria-describedby="clientidHelp" placeholder="Enter clientId">
                        <small id="clientidHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
                    </div>
                    <div class="form-group">
                        <label for="secret">Password</label>
                        <input type="text" class="form-control" id="secret" name="secret" placeholder="Secret">
                    </div>
                    <div class="form-group">
                        <label for="domain">Domain</label>
                        <input type="text" class="form-control" id="domain" name="domain" placeholder="Domain">
                    </div>
                    <div class="form-group form-check">
                        <input type="checkbox" class="form-check-input js-switch" id="clientEnabled" checked name="clientEnabled">
                        <label class="form-check-label" for="clientEnabled">is client enabled?</label>
                    </div>

            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary form-control">ADD</button>
            </div>
            </form>
        </div>
    </div>
</div>
<%
include("../scripts.btl"){}
%>
<script type="text/javascript">
    $(document).ready(function () {
        var jsswitchs = $(".switchery");
        for(var i=0;i<jsswitchs.length;i++){
            jswcpm = jsswitchs[i];
            jsw = jsswitchs[i].previousSibling;
            var jswid = jsw.id;
            if(jswid){
                var id = jswid.split("_")[1];
                if(id!=null){
                    jswcpm.id = "switcheryof_"+jsw.id;
                    jswcpm.onclick = function(event) {
                        var option = event.currentTarget.previousSibling.checked?"true":"false";
                        try{
                            var id = event.currentTarget.id.split("_")[2];
                        }catch (e){
                            println(e);
                            return;
                        }
                        var postData = JSON.stringify({enabled:option.toString(),clientid:id});
                        console.log("/nest/adminSetClientActive[POST]:"+postData);
                        $.ajax({
                            type:"POST",
                            contentType:"application/json",
                            url:"/nest/adminSetClientActive",
                            data:postData,
                            datType:"json",
                            async: false,
                            success:function (data) {
                                if(!data.enabled)
                                    event.currentTarget.previousSibling.checked = false;
                                else
                                    event.currentTarget.previousSibling.checked = true;
                            }
                        });
                    };
                }
            }
        }
    });
</script>
<%
include("../footer.btl"){}
%>