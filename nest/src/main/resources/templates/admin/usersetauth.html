<!DOCTYPE html>
<!--
  ~ Project:sparrow nest
  ~ LastModified:18-4-28 下午5:38 by sukimiya
  ~
  ~ Copyright (C) 2018.  e2x.io
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->
<%
include("../header.btl",{title:"Sparrow Nest"}){}
%>
<%
include("../topnav.btl"){}
%>
<div class="bg-light">
    <div class="container d-flex justify-content-between page-header">
        <h1 class="p-2 align-self-center">
            <a href="${ctxPath}/admin/users">Users</a> / ${currentUser.username} / authorities
        </h1>
        <div class="option-btn-group">

        </div>
    </div>
</div>
<div class="container s-page-content fully">
    <div class="justify-content-md-center">
        <div class="list-group col-lg">
            <% for(entry in listmap){
                var isActChecked="";
                if(entry.enabled)
                isActChecked="checked";
            %>
            <div class="list-group-item">
                <div class="d-flex justify-content-between">
                    <div class="d-flex flex-column justify-content-center col-md-6">
                        <div class="text-left"><h5>${entry.authority}</h5></div>
                    </div>
                </div>
                <div class="d-flex flex-column justify-content-between col-md-2">
                    <input type="checkbox" class="form-check-input js-switch" id="authority_${entry.authority}" name="authority" ${isActChecked}>
                </div>
            </div>
            <%}%>
        </div>
    </div>
</div>
</div>
<%
include("../scripts.btl"){}
%>
<script type="text/javascript">
    $(document).ready(function () {
        var jsswitchs = $(".switchery");
        for(var i=0;i<jsswitchs.length;i++){
            jswcpm = jsswitchs[i];
            jsw = jsswitchs[i].previousSibling;
            var jswid = jsw.id;
            if(jswid){
                var authName = jswid.split("_")[1];
                if(authName!=null){
                    jswcpm.id = "switcheryof_"+jsw.id;
                    jswcpm.onclick = function(event) {
                        var option = event.currentTarget.previousSibling.checked?true:false;
                        try{
                            var authof = event.currentTarget.id.split("_")[2];
                        }catch (e){
                            println(e);
                            return;
                        }
                        var username = "${currentUser.username}";
                        if(username==null) return;
                        var postData = JSON.stringify({username:username,enabled:option,authority:authof});
                        console.log("/nest/adminSetUserAuth[POST]:"+postData);
                        $.ajax({
                            type:"POST",
                            contentType:"application/json",
                            url:"/nest/adminSetUserAuth",
                            data:postData,
                            datType:"json",
                            async: false,
                            success:function (data) {
                                if(!data.enabled)
                                    event.currentTarget.previousSibling.checked = false;
                                else
                                    event.currentTarget.previousSibling.checked = true;
                            }
                        });
                    };
                }
            }
        }
    });
</script>
<%
include("../footer.btl"){}
%>